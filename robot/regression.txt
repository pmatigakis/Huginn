*** Settings ***
Suite Setup    Start Huginn
Suite Teardown    Stop Huginn
Library    Process
Library    Collections
Library    RequestsLibrary

*** Variables ***
${HUGINN_URL}    http://localhost:8090

*** Keywords ***
Start Huginn
    ${huginn_process_id} =    Start Process    huginn_start.py --aircraft Rascal    shell=true
    Process Should Be Running    ${huginn_process_id}
    Create Session    huginn_web_server    ${HUGINN_URL}
    Wait Until Keyword Succeeds    1 min    5 sec    Get Request    huginn_web_server    /
    
Stop Huginn
    Terminate All Processes

*** Test Cases ***
Front-end is ready
    [Documentation]    This test checks if the front end is displayed when you connect to the web server
    [Tags]    frontend
    Create Session    huginn_web_server    ${HUGINN_URL}
    ${resp} =    Get Request    huginn_web_server    /
    Should be Equal As Strings    ${resp.status_code}    200
    Should Contain    ${resp.text}    Flight simulator data viewer
    Should Contain    ${resp.text}    Flight data

GPS endpoint returns data
    [Documentation]    This test checks if the gps endpoint is working
    [Tags]    frontend    gps
    Create Session    huginn_web_server    ${HUGINN_URL}
    ${resp} =    Get Request    huginn_web_server    /aircraft/gps
    Should be Equal As Strings    ${resp.status_code}    200
    Dictionary Should Contain Key    ${resp.json()}    latitude
    Should Be Equal As Numbers    ${resp.json()['latitude']}    37.923255    precision=4
    Dictionary Should Contain Key    ${resp.json()}    longitude
    Should Be Equal As Numbers    ${resp.json()['longitude']}    23.921773    precision=4
    Dictionary Should Contain Key    ${resp.json()}    altitude
    Should Be Equal As Numbers    ${resp.json()['altitude']}    300.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    airspeed
    Should Be Equal As Numbers    ${resp.json()['airspeed']}    15.240000    precision=2
    Dictionary Should Contain Key    ${resp.json()}    heading
    Should Be Equal As Numbers    ${resp.json()['heading']}    45.00000    precision=4

Simulator endpoint returns data
    [Documentation]    This test checks if the simulator endpoint is working
    [Tags]    frontend    simulator
    Create Session    huginn_web_server    ${HUGINN_URL}
    ${resp} =    Get Request    huginn_web_server    /simulator
    Should be Equal As Strings    ${resp.status_code}    200
    Dictionary Should Contain Key    ${resp.json()}    time
    Should Be Equal As Numbers    ${resp.json()['time']}    0.0063     precision=4
    Dictionary Should Contain Key    ${resp.json()}    dt
    Should Be Equal As Numbers    ${resp.json()['dt']}    0.0063     precision=4
    Dictionary Should Contain Key    ${resp.json()}    running
    Should Not Be True    ${resp.json()['running']}

FDMData endpoint returns data
    [Documentation]    This test checks if the FDMData endpoint is working
    [Tags]    frontend    fdm
    Create Session    huginn_web_server    ${HUGINN_URL}
    ${resp} =    Get Request    huginn_web_server    /fdm
    Should be Equal As Strings    ${resp.status_code}    200
    Dictionary Should Contain Key    ${resp.json()}    latitude
    Should Be Equal As Numbers    ${resp.json()['latitude']}    37.923255    precision=4
    Dictionary Should Contain Key    ${resp.json()}    longitude
    Should Be Equal As Numbers    ${resp.json()['longitude']}    23.921773    precision=4
    Dictionary Should Contain Key    ${resp.json()}    altitude
    Should Be Equal As Numbers    ${resp.json()['altitude']}    300.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    airspeed
    Should Be Equal As Numbers    ${resp.json()['airspeed']}    15.240000    precision=2
    Dictionary Should Contain Key    ${resp.json()}    heading
    Should Be Equal As Numbers    ${resp.json()['heading']}    45.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    aileron
    Should Be Equal As Numbers    ${resp.json()['aileron']}    0.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    elevator
    Should Be Equal As Numbers    ${resp.json()['elevator']}    0.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    rudder
    Should Be Equal As Numbers    ${resp.json()['rudder']}    0.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    throttle
    Should Be Equal As Numbers    ${resp.json()['throttle']}    0.00000    precision=4
    Dictionary Should Contain Key    ${resp.json()}    x_acceleration
    Dictionary Should Contain Key    ${resp.json()}    y_acceleration
    Dictionary Should Contain Key    ${resp.json()}    z_acceleration
    Dictionary Should Contain Key    ${resp.json()}    roll_rate
    Dictionary Should Contain Key    ${resp.json()}    pitch_rate
    Dictionary Should Contain Key    ${resp.json()}    yaw_rate
    Dictionary Should Contain Key    ${resp.json()}    temperature
    Dictionary Should Contain Key    ${resp.json()}    static_pressure
    Dictionary Should Contain Key    ${resp.json()}    total_pressure
    Dictionary Should Contain Key    ${resp.json()}    roll
    Dictionary Should Contain Key    ${resp.json()}    pitch
    Dictionary Should Contain Key    ${resp.json()}    thrust
